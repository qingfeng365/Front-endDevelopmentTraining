# 第04讲 新闻详情页

## 调整导航栏颜色设置

`app.json`

```json
  "window": {
    "navigationBarBackgroundColor": "#405f80"
  }
```

`welcome.json`

```json
{
  "navigationBarBackgroundColor": "#b3d4db"
}
```

## 新建页面 news-detail

创建目录: `pages/news/news-detail/`

新建页面 news-detail

## 导航到详情页

### `news.wxml`

```html
<import src="news-card-template/news-card"/>
<view>
  <swiper indicator-dots="{{true}}" indicator-color="rgba(255, 255, 255, .75)" autoplay="{{true}}" circular="{{true}}">
    <swiper-item>
      <image src="/images/cheetah.jpg" mode='aspectFill'></image>
    </swiper-item>
    <swiper-item>
      <image src="/images/duck.jpg" mode='aspectFill'></image>
    </swiper-item>
    <swiper-item>
      <image src="/images/eagle.jpg" mode='aspectFill'></image>
    </swiper-item>
  </swiper>
  <view class="news-container">
    <block wx:for="{{newsList}}">
      <view catchtap="onListTap" data-post-id="{{item.postId}}">
        <template is="news-card" data="{{...item}}" />
      </view>
    </block>
  </view>
</view>
```

### `news.js`

```js
  onListTap: (event)=>{
    console.log('onListTap:',event);
    var postId = event.currentTarget.dataset.postId;
    wx.navigateTo({
      url: 'news-detail/news-detail?id=' + postId,
    })
  },
```

> 要特别注意在 wxml 中, 设置 data-xxx 属性的大小写规则
> 应全小写,用 - 分割单词 , - 后面的字母会在 dataset 中自动转大写 (第一个 - 除外)
>

## 处理详情页数据

### `news-detail.js`

```js
let newsList = require('../../../data/news-data.js');

Page({

  /**
   * 页面的初始数据
   */
  data: {
  
  },

  /**
   * 生命周期函数--监听页面加载
   */
  onLoad: function (options) {
    let postId = +options.id;
    let postData = newsList.find((item) => item.postId === postId);
    console.log(postData);
    this.setData({
      ...postData
    });
    console.log(this.data);
  },

  /**
   * 生命周期函数--监听页面初次渲染完成
   */
  onReady: function () {
  
  },

  /**
   * 生命周期函数--监听页面显示
   */
  onShow: function () {
  
  },

  /**
   * 生命周期函数--监听页面隐藏
   */
  onHide: function () {
  
  },

  /**
   * 生命周期函数--监听页面卸载
   */
  onUnload: function () {
  
  },

  /**
   * 页面相关事件处理函数--监听用户下拉动作
   */
  onPullDownRefresh: function () {
  
  },

  /**
   * 页面上拉触底事件的处理函数
   */
  onReachBottom: function () {
  
  },

  /**
   * 用户点击右上角分享
   */
  onShareAppMessage: function () {
  
  }
})
```

## 处理详情页视图

`news-detail.json`

```json
{
  "navigationBarTitleText": "文章"
}
```

### `news-detail.wxml`

```html
<view class='d-flex flex-column'>
  <view>
    <image class="header-image" src="{{headImgSrc}}" mode="aspectFill"></image>
  </view>
  <view class="post d-flex flex-column">
    <view class="post-header d-flex flex-column justify-content-between">
      <view class="author-bar">
        <image class="author-avatar" src="{{avatar}}"></image>
        <text class="author-name">{{author}}</text>
        <text class="normal-text">发表于 {{dateTime}}</text>
      </view>
      <text class="post-title">{{title}}</text>
      <view class="post-toolbar d-flex justify-content-end align-items-center">
        <view class="horizon-line"></view>
        <image src="/images/icon/collection.png"></image>
        <image src="/images/icon/collection-anti.png"></image>
        <image src="/images/icon/share.png"></image>
      </view>
    </view>
    <text class="post-body">{{detail}}
    </text>
  </view>
</view>
```


### `news-detail.wxss`

```css
.header-image {
  width: 100%;
  max-width: 100%;
  height: 500rpx;
}

.post {
  padding: 16px;
}

.post-header {
  min-height: 300rpx;
}

.author-avatar {
  height: 64rpx;
  width: 64rpx;
  vertical-align: middle;
  border-radius: 50%;
}

.author-name {
  font-size: 16px;
  font-weight: 300;
  margin-left: 20rpx;
  vertical-align: middle;
  color: #666;
}

.normal-text {
  font-size: 12px;
  color: #999;
  margin-left: 20rpx;
}

.post-title {
  font-size: 18px;
  font-weight: 700;
  letter-spacing: 2px;
  color: #4b556c;
}

.post-toolbar{
  position: relative;
}

.post-toolbar image {
  width: 90rpx;
  height: 90rpx;
  margin: 0 10rpx;
}

.post-body {
  color: #666;
  margin-top: 16px;
  font-size: 14px;
  line-height: 2;
  letter-spacing: 2px;
}

.horizon-line {
  width: 670rpx;
  height: 1px;
  background-color: #e5e5e5;
  position: absolute;
  left: 0;
  top:50%;
  z-index: -99;
}

```