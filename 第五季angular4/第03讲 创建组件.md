# 第03讲 创建组件

## 本讲项目介绍

### 项目名称

`mystock`

github 项目地址
[https://github.com/qingfeng365/mystock.git](https://github.com/qingfeng365/mystock.git)

### 初始准备

- 新建普通项目
- 引入jquery bootstrap 第三包

```bash
ng new mystock --skip-install

cd mystock

npm install --registry=https://registry.npm.taobao.org --disturl=https://npm.taobao.org/dist --sass-binary-site=http://npm.taobao.org/mirrors/node-sass

ng serve

npm install jquery bootstrap --save

```


`.angular-cli.json`

```
      "styles": [
        "styles.css",
        "../node_modules/bootstrap/dist/css/bootstrap.css"
      ],
      "scripts": [
        "../node_modules/jquery/dist/jquery.js",
        "../node_modules/bootstrap/dist/js/bootstrap.js"
      ],
```


### 布局说明


```js
`|---------------------| ` 
`|       navbar        | ` 
`|---------------------| ` 
`| search  | carousel  | `     
`|         |           | ` 
`|         |-----------| ` 
`|         | product   | `
`|         |   (stars) | `  
`|---------------------| `  
`|     footer          | ` 
`|---------------------| ` 
```

### 创建组件

在项目根目录命令行运行

```bash
ng g c navbar
ng g c search
ng g c carousel
ng g c product
ng g c footer
ng g c stars
```

### @NgModule

`/src/app/app.module.ts`

```ts
import { BrowserModule } from '@angular/platform-browser';
import { NgModule } from '@angular/core';
import { FormsModule } from '@angular/forms';
import { HttpModule } from '@angular/http';

import { AppComponent } from './app.component';
import { NavbarComponent } from './navbar/navbar.component';
import { SearchComponent } from './search/search.component';
import { CarouselComponent } from './carousel/carousel.component';
import { ProductComponent } from './product/product.component';
import { FooterComponent } from './footer/footer.component';
import { StarsComponent } from './stars/stars.component';

@NgModule({
  declarations: [
    AppComponent,
    NavbarComponent,
    SearchComponent,
    CarouselComponent,
    ProductComponent,
    FooterComponent,
    StarsComponent
  ],
  imports: [
    BrowserModule,
    FormsModule,
    HttpModule
  ],
  providers: [],
  bootstrap: [AppComponent]
})
export class AppModule { }

```



### 关于angular模块的说明

[https://angular.cn/docs/ts/latest/guide/appmodule.html](https://angular.cn/docs/ts/latest/guide/appmodule.html)
[https://angular.cn/docs/ts/latest/guide/ngmodule.html](https://angular.cn/docs/ts/latest/guide/ngmodule.html)

- imports: 元素必须是模块,要引用的其它性性模块
- declarations: 在本模块声明的 `组件、指令和管道`, 注意 `服务` 以及其它类,不需要在此声明
    (可以理解成在组件视图模板中用的,就需要声明)
- bootstrap: 根组件, 只有根模块才需要设置,在index.html要引用的根组件


### @Component


```ts
import { Component, OnInit } from '@angular/core';

@Component({
  selector: 'app-navbar',
  templateUrl: './navbar.component.html',
  styleUrls: ['./navbar.component.css']
})
export class NavbarComponent implements OnInit {

  constructor() { }

  ngOnInit() {
  }

}
```

- selector: CSS 选择器
- templateUrl,styleUrls: 模板与样式文件

#### 关于类的说明:

[https://www.tslang.cn/docs/handbook/classes.html](https://www.tslang.cn/docs/handbook/classes.html)

- 成员:属性,构造函数,方法
- 可见性: public private(不能在外部访问) protected(子类可以访问)
- 一般不需要定义可见性,因为ts默认public

> 关于constructor的特殊说明
> angular对constructor参数做了特殊处理,如果参数定义了 public ,会自动创建同名属性 


#### 其它说明

constructor 先执行
ngOnInit 后执行

`implements`

表示 类 实现 某个特定的接口

`OnInit`

是 @angular/core 定义的接口

要求实现方法

```ts
export interface OnInit {
    ngOnInit(): void;
}
```

`ngOnInit`

在组件实例创建完成后, 且组件声明的输入属性绑定首次执行后,会执行一次

即父组件传递属性后,执行

用于 子组件在首次创建后,并接收到父组件传来值后,进行 内部属性的初始化


>说明
[https://angular.cn/docs/ts/latest/guide/architecture.html#!#metadata](https://angular.cn/docs/ts/latest/guide/architecture.html#!#metadata)



### 设置根组件的视图

> 使用jade的方法.md



`/src/app/app.component.jade`

```jade
app-navbar
.container
  .row
    .col-md-3
      app-search
    .col-md-9
      .row.carousel-container
        app-carousel
      .row
        app-product
app-footer
```

### navbar

`/src/app/navbar/navbar.component.jade`

```jade
nav.navbar.navbar-inverse.navbar-fixed-top
  .container
    .navbar-header
      button.navbar-toggle(type="button",data-toggle="collapse",data-target=".navbar-ex1-collapse")
        span.icon-bar
        span.icon-bar
        span.icon-bar
      a.navbar-brand(href="#") 在线竞拍
    .collapse.navbar-collapse.navbar-ex1-collapse
      ul.nav.navbar-nav
        li
          a(href="#") 关于我们
        li
          a(href="#") 联系我们
        li
          a(href="#") 网站地图
```

### 设置全局样式

`/src/styles.css`

```css
body {
  padding-top: 70px;
}
```

### footer

`/src/app/footer/footer.component.jade`

```jade
.container
  hr
  footer
    .row
      .col-lg-12
        p Angular4课程-2017
```

### search

`/src/app/search/search.component.jade`

```jade
form(name='searchForm', role='form')
  .form-group
    label(for='productTitle') 商品名称:
    input#productTitle.form-control(type='text', placeholder='商品名称')
  .form-group
    label(for='productPrice') 商品价格:
    input#productPrice.form-control(type='number', min='0', placeholder='商品价格')
  .form-group
    label(for='productCategory') 商品分类:
    select#productCategory.form-control
  .form-group
    button.btn.btn-primary.btn-block(type='submit') 搜索
```




## 命令行说明

### `ng g component`

`ng generate component [name]`

可简写为:

`ng g c [name]`


组件创建到 `src/app` 目录

可以指定目录,但目录会 `src/app` 下级目录创建

当指定目录时,跟命令行窗口当前目录有关系

如果命令行窗口当前目录,是`src/app` 目录或上级目录, 则目录会在 `src/app` 的下级目录创建

如果命令行窗口当前目录,本身已经是`src/app` 的下级目录, 则目录会在 当前目录的下级目录创建

### app.module.ts

如果不指定模块,则会自动在 根模块 引入新组件

### 常见错误

在引用组件时,如果 使用[属性绑定], 属性如果不存在, 到导致根组件无法加载,

要注意检查,特别是在组件未完成的情况,就先引用时,要特别注意检查




### 输入属性

当需要在组件声明时,同时传入父组件的值或需要指定特殊值时,

需要定义输入属性

```ts
export class StarsComponent implements OnInit {

  @Input()
  private rating = 0;
}
```


```html
      <app-stars [rating]="product.rating"></app-stars>
```


### 命令行说明

[Component](https://github.com/angular/angular-cli/wiki/generate-component) 

`ng g component my-new-component`


ng generate component
Overview

ng generate component [name] generates a component
Options
app

`--app` (alias: `-a`) _default value: 1st app_

Specifies app name to use.
change-detection

`--change-detection` (alias: `-cd`)

Specifies the change detection strategy.
flat

`--flat` _default value: false_

Flag to indicate if a dir is created.
export

`--export` (alias: `-`) _default value: false_

Specifies if declaring module exports the component.
inline-style

`--inline-style` (alias: `-is`) _default value: false_

Specifies if the style will be in the ts file.
inline-template

`--inline-template` (alias: `-it`) _default value: false_

Specifies if the template will be in the ts file.
module

`--module` (alias: `-m`)

Allows specification of the declaring module.
prefix

`--prefix`

Specifies whether to use the prefix.
skip-import

`--skip-import` _default value: false_

Allows for skipping the module import.
spec

`--spec`

Specifies if a spec file is generated.
view-encapsulation

`--view-encapsulation` (alias: `-ve`)

Specifies the view encapsulation strategy.
