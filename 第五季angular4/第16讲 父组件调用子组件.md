# 第16讲 父组件调用子组件

## 本讲项目介绍

### 项目名称

`mycomponent`

github 项目地址


备课项目

`mycomponent-test`

github 项目地址


分支: E16

## 创建变更检测演示组件及设置路由

`ng g c mainViewChildDemo`

`/src/app/app-routing.module.ts`

```ts
import { NgModule } from '@angular/core';
import { Routes, RouterModule } from '@angular/router';
import { MainMessageDemoComponent } from './main-message-demo/main-message-demo.component';
import { MainLifeDemoComponent } from './main-life-demo/main-life-demo.component';
import { MainCheckedDemoComponent } from './main-checked-demo/main-checked-demo.component';
import { MainViewChildDemoComponent } from './main-view-child-demo/main-view-child-demo.component';

const routes: Routes = [
  {
    path: '',
    redirectTo: 'message',
    pathMatch: 'full'
  },
  {
    path: 'message',
    component: MainMessageDemoComponent
  },
  {
    path: 'life',
    component: MainLifeDemoComponent,
  },
  {
    path: 'checked',
    component: MainCheckedDemoComponent,
  },
  {
    path: 'viewchild',
    component: MainViewChildDemoComponent,
  }
];

@NgModule({
  imports: [RouterModule.forRoot(routes)],
  exports: [RouterModule]
})
export class AppRoutingModule { }

```

`/src/app/app.component.jade`

```jade
.container
  h2 组件项目
  div
    a([routerLink]="['message']") 组件通讯演示
    | &nbsp;
    a([routerLink]="['life']") 生命周期演示   
  hr
  router-outlet
```


## 引用模板元素及子组件的方式

[https://v2.angular.cn/docs/ts/latest/api/core/index/ViewChild-decorator.html](https://v2.angular.cn/docs/ts/latest/api/core/index/ViewChild-decorator.html)


[https://v2.angular.cn/docs/ts/latest/api/core/index/ViewChildren-decorator.html](https://v2.angular.cn/docs/ts/latest/api/core/index/ViewChildren-decorator.html)


### 创建父子组件

`ng g c viewChildDemoBasicChild`
`ng g c viewChildDemoBasicParent`





`ng g c viewChildDemoChild`
`ng g c viewChildDemoParent`



`ng g c viewChildDemoAdvChild`
`ng g c viewChildDemoAdvParent`


## 定义子组件的方法

`/src/app/child/child.component.ts`

```ts
import {
  Component, OnInit, Input, OnChanges, SimpleChanges, DoCheck,
  AfterViewInit, AfterViewChecked
} from '@angular/core';

@Component({
  selector: 'app-child',
  templateUrl: './child.component.html',
  styleUrls: ['./child.component.css']
})
export class ChildComponent implements OnInit {
  ngOnInit(): void {

  }
  greeting(name: string) {
    console.log('hello ' + name);
  }

}
```

`/src/app/child/child.component.html`

```html
<p>
  child works!
</p>
```


## 父组件调用子组件的方法

`/src/app/app.component.html`

```html
<app-child #child1></app-child>
<app-child #child2></app-child>
<button (click)="child2.greeting('Jerry')">调用child2的greeting方法</button>
```


`/src/app/app.component.ts`

```ts
import { ChildComponent } from './child/child.component';
import { Component, ViewChild, OnInit, AfterViewInit, AfterViewChecked } from '@angular/core';


@Component({
  selector: 'app-root',
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.css']
})
export class AppComponent implements OnInit {

  message: string;

  @ViewChild('child1')
  child1: ChildComponent;

  constructor() { }

  ngOnInit(): void {
    this.child1.greeting("Tom");
  }
}

```

## 方式1说明

通过代码调用子组件的要点:

- 使用`@ViewChild` 装饰器,将子组件映射到父组件的属性上
- 要使用`@ViewChild` 装饰器,还必须在模板中定义子组件的本地变量
- `@ViewChild`装饰器要使用模板的本地变量作为参数


## 方式2说明

在模板中直接调用的要点

- 只需要在模板中定义子组件的本地变量
- 直接通过本地变量调用


