
# 第20讲 组件生命周期钩子使用原则

## 使用原则

- 变更检测机制: 监控组件属性的变化并自动更新视图,这个检测非常频繁并且默认是针对整个组件树
- 可以标记组件树的一个分支,排除在变更检测机制之外



## 改造星级评价组件

- 可用于编辑状态,即可点击星星
- 点击星星后,可发射事件
- 支持双向绑定
- 父组件可决定星级评价组件是显示状态还是可编辑状态


`/src/app/stars/stars.component.html`

```html
<p>
  <span *ngFor="let star of stars; let i=index;" class="glyphicon glyphicon-star" [class.glyphicon-star-empty]="star" (click)="clickStar(i)"></span>
  <span>{{rating | number:'1.0-2'}}星</span>
</p>
```

> 说明:
> ngFor 指令可以提供 变量 index

`/src/app/stars/stars.component.ts` 

```ts
import { Component, OnInit, Input, Output, EventEmitter, OnChanges, SimpleChanges } from '@angular/core';

@Component({
  selector: 'app-stars',
  templateUrl: './stars.component.html',
  styleUrls: ['./stars.component.css']
})
export class StarsComponent implements OnInit, OnChanges {


  @Input()
  private rating = 0;
  @Output()
  private ratingChange: EventEmitter<number> = new EventEmitter();
  @Input()
  private readonly: boolean = true;

  private stars: boolean[] = [];
  constructor() {
  }

  ngOnInit() {
    // ngOnChanges 会在 ngOnInit 之前先触发一次,因此此处代码不需要了
    // for (let i = 1; i <= 5; i++) {
    //   this.stars.push(i > this.rating);
    // }
  }

  ngOnChanges(changes: SimpleChanges): void {
    this.stars = [];
    for (let i = 1; i <= 5; i++) {
      this.stars.push(i > this.rating);
    }
  }

  clickStar(index: number) {
    if (!this.readonly) {
      this.rating = index + 1;
      this.ratingChange.emit(this.rating);
    }
  }
}

```

> 说明:
> 支持双向绑定的方式:
> 输出属性名称 = 输入属性 + `Change`
> 在父组件就可以用 `[(输入属性)]` 方式实现双向绑定
> 同时,注意输出属性发射的数据就是 双向绑定属性的值

