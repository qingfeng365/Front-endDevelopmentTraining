# 第21讲 响应式表单

## 创建响应式表单的步骤

- 引入响应式表单模块
- 创建数据模型
- 创建表单视图模板
- 视图模板绑定数据模型

## 创建新的示例项目 myapp-form

## 创建表单组件

`ng g c formdemo1`

## 响应式表单模块

`/src/app/app.module.ts`

```ts
//...
import { FormsModule, ReactiveFormsModule } from '@angular/forms';
//...

@NgModule({
  //...
  imports: [
    //...
    ReactiveFormsModule
  ],
  providers: [],
  bootstrap: [AppComponent]
})
```




## 数据模型

### 相关类

- FormControl : 输入元素控制器(表单控制器), 
- FormGroup : 以Key-value形式包含多个FormControl的容器, 通常代表整个表单
- FormArray : 以数组形式包含多个FormControl的容器,常用于需要增长的元素集合

```ts
import { FormControl, FormGroup, FormArray } from '@angular/forms';
```

相关api文档
[https://angular.cn/docs/ts/latest/api/forms/index/AbstractControl-class.html]


### 如何创建FormControl

```ts
userName: FormControl = new FormControl('abc');
```

> 参数表示初始值

### 如何创建FormGroup

```ts
  dateGroup: FormGroup = new FormGroup({
    from: new FormControl(),
    to: new FormControl()
  });
```

### 如何创建FormArray

```ts
  emails: FormArray = new FormArray([
    new FormControl('a@abc.com'),
    new FormControl('b@abc.com'),
    new FormControl('c@abc.com'),
  ]);
```

### 先写一个基本的表单视图

`/src/app/formdemo1/formdemo1.component.html`

```html
<form>
  <div>
    名称:<input type="text">
  </div>
  <div>
    <div>
      开始日期:<input type="date">
    </div>
    <div>
      结束日期:<input type="date">
    </div>
  </div>
  <div>
    <ul>
      <li><input type="text"></li>
      <button type="button">新增email</button>
    </ul>
    <div>
      <button type="submit">保存</button>
    </div>
  </div>
</form>
```

### 创建代表整个表单的数据模型

```ts
  formModel: FormGroup = new FormGroup({});
  onSubmit() {
    console.log(this.formModel.value);
  }  
```

### 在视图绑定表单模型

`/src/app/formdemo1/formdemo1.component.html`

```html
<form [formGroup]="formModel" (submit)="onSubmit()">
```

### 将表单数据模型添加完整


`/src/app/formdemo1/formdemo1.component.ts`

```ts
  userName: FormControl = new FormControl('abc');

  dateGroup: FormGroup = new FormGroup({
    from: new FormControl(),
    to: new FormControl()
  });

  emails: FormArray = new FormArray([
    new FormControl('a@abc.com'),
    new FormControl('b@abc.com'),
    new FormControl('c@abc.com'),
  ]);

  formModel: FormGroup = new FormGroup({
    userName: this.userName,
    date: this.dateGroup,
    emails: this.emails,
  });
```

也可以直接写成:

```ts
  formModel: FormGroup = new FormGroup({
    userName: new FormControl('abc'),
    date: new FormGroup({
      from: new FormControl(),
      to: new FormControl()
      }),
    emails: new FormArray([
      new FormControl('a@abc.com'),
      new FormControl('b@abc.com'),
      new FormControl('c@abc.com'),
      ]),
  });
```


### 在视图绑定表单元素

`/src/app/formdemo1/formdemo1.component.html`

```html
<form [formGroup]="formModel" (submit)="onSubmit()">
  <div>
    名称:<input type="text" formControlName="userName">
  </div>
  <div formGroupName="date">
    <div>
      开始日期:<input type="date" formControlName="from">
    </div>
    <div>
      结束日期:<input type="date" formControlName="to">
    </div>
  </div>
  <div>
    <ul formArrayName="emails">
      <li *ngFor="let email of formModel.get('emails').controls; index as i">
        <input type="text" [formControlName]="i">
      </li>
      <button type="button">新增email</button>
    </ul>
    <div>
      <button type="submit">保存</button>
    </div>
  </div>
</form>
```

### 实现新增

```ts
  addEmail() {
    this.emails.push(new FormControl());
  }
```

```html
      <button type="button" (click)="addEmail()">新增email</button>
```

另一种写法:

```ts
  addEmail() {
    const emails = this.formModel.get('emails') as FormArray;
    emails.push(new FormControl());
  }
```

### 绑定指令

formGroup  (用于顶级绑定) ([属性绑定])
formControl  (用于顶级绑定)([属性绑定]) (不常用,非表单内部的元素才会用到)

formGroupName (用于子级绑定) (一般情况只需要普通绑定)
formControlName (用于子级绑定) (一般情况只需要普通绑定)

formArrayName(用于绑定formArray)

